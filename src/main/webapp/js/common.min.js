var Action={ajsxSucc:function(a,b){if(b){b(a)}},jsonAsyncActByData:function(a,b,c){$.ajax({type:"POST",url:a,async:true,traditional:true,dataType:"json",data:b,success:function(d){Action.ajsxSucc(d,c)},error:function(f,e,d){Action._showError("后台出错，请查看日志")}})},jsonSyncActByData:function(a,b,c){$.ajax({type:"POST",url:a,async:false,traditional:true,dataType:"json",data:b,success:function(d){Action.ajsxSucc(d,c)},error:function(f,e,d){Action._showError("后台出错，请查看日志")}})},getQueryString:function(d){var b=location.href;b=b.toLowerCase();d=d.toLowerCase();if(b.indexOf("?")==-1){return""}var a=b.split("?");a=a[a.length-1];a=a.split("&");for(var c=0;c<a.length;c++){var e=a[c].split("=");if(e[0]==d){return e[1]}}return""},_showError:function(c,b){b=b||"提示";var a=parent.$||a;a.messager.show({title:b,msg:c,style:{right:"",top:document.body.scrollTop+document.documentElement.scrollTop,bottom:""}})}};var Crud=(function(){var a=function(d){this.addUrl=d.addUrl;this.listUrl=d.listUrl;this.updateUrl=d.updateUrl;this.delUrl=d.delUrl;this.pk=d.pk;this.encryptConfig=d.encryptConfig;this.$dlg=$("#"+d.dlgId);this.$form=$("#"+d.formId);this.$grid=$("#"+d.gridId);this.gridType="datagrid";this.submitUrl};a.prototype={add:function(d){d=d||"添加";this.$dlg.dialog("open").dialog("setTitle",d);this.$form.form("reset");this.submitUrl=this.addUrl;if(this._hasPkInput()){this.getPkInput().prop("disabled",false)}},update:function(e,d){d=d||"修改";if(e){this.$dlg.dialog("open").dialog("setTitle",d);this.$form.form("clear").form("load",e);this.submitUrl=this.updateUrl+["?",this.pk,"=",e[this.pk]].join("");if(this._hasPkInput()){this.getPkInput().prop("disabled",true)}}},runGridMethod:function(d,e){this.$grid[this.gridType](d,e)},_hasPkInput:function(){return this.getPkInput().length>0},getPkInput:function(){if(!this.pkInput){this.pkInput=this.getByName(this.pk)}return this.pkInput},getByName:function(d){return this.$form.find("[name="+d+"]")},del:function(f,e){e=e||"确定要删除该数据吗?";var d=this;if(f){$.messager.confirm("Confirm",e,function(g){if(g){$.post(d.delUrl,f,function(h){if(h.success){d.runGridMethod("reload")}else{b(h.errorMsg)}},"json")}})}},save:function(){var d=this;this.$form.form("submit",{url:this.submitUrl,onSubmit:function(){d._doEncrypt();return $(this).form("validate")},success:function(g){var e=$.parseJSON(g);if(e.success){d.$dlg.dialog("close");d.runGridMethod("reload")}else{var f=e.errorMsg;f=f||c(e);b(f)}}})},_doEncrypt:function(){if(this.encryptConfig){var h=this.encryptConfig.encrypt;var e=this.encryptConfig.fields||[];for(var f=0,d=e.length;f<d;f++){var j=this.getByName(e[f]);var g=faultylabs.MD5($.trim(j.val()));j.val(g)}}},createOperColumn:function(d){return Crud.createOperColumn(d)},createEditColumn:function(d){d=$.isArray(d)?d:[];var f=this;var e=[{text:"修改",onclick:function(g){f.update(g)}},{text:"删除",onclick:function(g){f.del(g)}}].concat(d);return this.createOperColumn(e)},createOperFormatter:function(d){return Crud.createOperFormatter(d)},buildGrid:function(e,d){var f={url:this.listUrl,columns:[e],toolbar:"#toolbar",pagination:true,fitColumns:true,singleSelect:true,striped:true,pageSize:20};$.extend(f,d);this.$grid.datagrid(f)},buildTreegrid:function(e,d){this.gridType="treegrid";var f={url:this.listUrl,columns:[e],toolbar:"#toolbar",fitColumns:true,animate:true,collapsible:true,pageSize:20};$.extend(f,d);this.$grid.treegrid(f)},closeDlg:function(){this.$dlg.dialog("close")}};function b(d){var e=parent.$||e;e.messager.show({title:"提示",msg:d,style:{right:"",top:document.body.scrollTop+document.documentElement.scrollTop,bottom:""}})}function c(d){var e=d.validateErrors;return e.join("<br>")}return{create:function(d){return new a(d)},createOperColumn:function(d){return{field:"_operate",title:"操作",align:"center",formatter:this.createOperFormatter(d)}},createOperFormatter:function(d){d=$.isArray(d)?d:[];var e=function(n,m,h){var l=[];for(var k=0,g=d.length;k<g;k++){var j=d[k];var f=j.showFun||function(){return true};if(f(m)){l.push('<a href="javascript:void(0)" onclick="'+FunUtil.createFun(j,"onclick",m,n,h)+'">'+j.text+"</a>")}}return l.join(" | ")};return e}}})();var EventUtil={getEvent:function(){if(window.event){return this.formatEvent(window.event)}else{return this.getEvent.caller.arguments[0]}},formatEvent:function(a){if($.browser.msie){a.charCode=(a.type=="keypress")?a.charCode:0;a.eventPhase=2;a.isChar=(a.charCode>0);a.pageX=a.clientX+document.body.scrollLeft;a.pageY=a.clientY+document.body.scrollTop;a.preventDefault=function(){this.returnValue=false};if(a.type=="mouseout"){a.relateTarget=a.toElement}else{if(a.type=="mouseover"){a.relateTarget=a.fromElement}}a.stopPropagation=function(){this.cancelBubble=true};a.target=a.srcElement;a.timestamp=(new Date()).getTime()}return a}};var FunUtil=(function(){var b=0;var a=[];return{createFun:function(h,f){var e=b++;var d=[];for(var g=2,c=arguments.length;g<c;g++){d.push(arguments[g])}a[e]=(function(k,j,i){return function(){k[j].apply(k,i)}}(h,f,d));return"FunUtil._runFun(event,"+e+");"},_runFun:function(f,c){var d=a[c];d();if(typeof f.preventDefault==="function"){f.preventDefault();f.stopPropagation()}else{f.returnValue=false;f.cancelBubble=true}}}})();if(typeof(jQuery)!="undefined"){$(document).ajaxError(function(c,b,a){if(b.getResponseHeader("X-timeout")&&b.status==401){top.location.href=ctx}else{alert("系统异常")}})}var Globle={logout:function(){$.ajax({type:"POST",url:ctx+"logout.do",dataType:"json",success:function(a){if(a.success){location.reload()}},error:function(){location.reload()}})},removeIframe:function(a){return function(){$("#"+a).find("iframe").remove()}}};var HtmlUtil=(function(){var a={"<":"&lt;",">":"&gt;","\r\n":"<br>"," ":"&nbsp;","\t":"&nbsp;&nbsp;&nbsp;&nbsp;"};var c={"&nbsp;":" ","<br ?/?>":"\r\n","&lt;":"<","&gt;":">"};function b(e,f){for(var d in f){e=e.replace(new RegExp(d,"g"),f[d])}return e}return{parseToHtml:function(d){return b(d,a)},parseToText:function(d){return b(d,c)}}}());var MaskUtil=(function(){var b,a;var d="正在处理，请稍待。。。";function c(){if(!b){b=$('<div class="datagrid-mask mymask"></div>').appendTo("body")}if(!a){a=$('<div class="datagrid-mask-msg mymask">'+d+"</div>").appendTo("body").css({"font-size":"12px"})}b.css({width:"100%",height:$(document).height()});a.css({left:($(document.body).outerWidth(true)-190)/2,top:($(window).height()-45)/2})}return{mask:function(e){c();b.show();a.html(e||d).show()},unmask:function(){b.hide();a.hide()}}}());var MsgUtil={topMsg:function(b,a){a=a||"提示";this.getJQ().messager.show({title:a,msg:b,showSpeed:300,style:{right:"",top:document.body.scrollTop+document.documentElement.scrollTop,bottom:""}})},alert:function(c,b,a){b=b||"提示";a=a||"info";if(c&&c.length>1000){this.getJQ().messager.show({title:b,msg:'<div style="height:300px;overflow-y: auto; overflow-x:hidden;">'+c+"</div>",width:600,height:350,showType:null,timeout:0,style:{right:"",bottom:""}})}else{$.messager.alert(b,c,a)}},error:function(b,a){a=a||"错误";this.alert(b,a,"error")},confirm:function(b,c,a){a=a||"确认";this.getJQ().messager.confirm(a,b,function(d){if(d){c()}})},getJQ:function(){return top.$||$}};